<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/png" href="/images/favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <title>Workspace</title>

  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <script src="http://s.codepen.io/assets/libs/modernizr.js" type="text/javascript"></script>    
    <link rel="stylesheet" href="/stylesheets/reset.css">
    <link rel='stylesheet prefetch' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css'>
        <link rel="stylesheet" href="/stylesheets/style.css">
    <link href='http://fonts.googleapis.com/css?family=Gloria+Hallelujah' rel='stylesheet' type='text/css'>

    <!-- Bootstrap core CSS     -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />



    <!--  Light Bootstrap Table core CSS    -->
    <link href="/stylesheets/light-bootstrap-dashboard.css" rel="stylesheet"/>


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="/stylesheets/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="/stylesheets/pe-icon-7-stroke.css" rel="stylesheet" />

    <link rel="stylesheet" href="/stylesheets/jsplumb/css/jsPlumbToolkit-defaults.css">
    <link rel="stylesheet" href="/stylesheets/jsplumb/css/main.css">
    <link rel="stylesheet" href="/stylesheets/jsplumb/css/jsPlumbToolkit-demo.css">
    <link rel="stylesheet" href="/stylesheets/workspace/workspace.css">

</head>
<body>


<div id="modalService" class="modal" >

  <!-- Service Modal content -->
  <div class="modal-content" style="background-color:#BBBF88;">
    <span class="closeServiceModal">x</span>
    <!-- <form name="containerOptions" id="containerOptions"> -->
    <label>Service ID:  </label><label id="box-id"></label><br/>
    <div style="position:absolute;left:25px;">

    <form id="modalServiceForm" enctype="application/json" action="javascript:test()">
        <input type="hidden" id="service[apiVersion]" value="v1"/>
        <input type="hidden" id="service[kind]" value="Service"/>
        <div style="width:80%;height:180%;display:table;">
          <div style="display:table-row;"> 
            <div style="display:table-cell;width:50%">Metadata:<br/>
              <ul>
                <li>&nbsp;&nbsp;Name     :<input type="text" id="service[metadata][name]" style="margin-left:115px;" size=20/><br/><br/></li>   
              </ul>
            </div></div>
            <div style="display:table-row;text-align: left;"> 
            <strong>Specs</strong>
            </div>
            
           <div style="display:table-row;position:absolute;left:30px;"> 
                <div style="display:table-cell;">
                  <ul>
                      <li><strong>Ports:</strong><br/>
                        <ul>
                          <li><p></p>
                            <ul>
                              <li>Port:<input type="text" id="service[spec][ports][0][port]" style="margin-left:113px;" size=20/><br/></li>
                              <li>TargetPort:<input type="text" id="service[spec][ports][0][targetPort]" style="margin-left:75px;" size=20/></li>
                            </ul>
                          </li>
                          <li><p></p>
                            <ul>
                              <li>Port:<input type="text" id="service[spec][ports][0][port]" style="margin-left:113px;" size=20/><br/></li>
                              <li>TargetPort:<input type="text" id="service[spec][ports][0][targetPort]" style="margin-left:75px;" size=20/></li>
                            </ul>
                          </li>
                          <li><p></p>
                            <ul>
                              <li>Port:<input type="text" id="service[spec][ports][0][port]" style="margin-left:113px;" size=20/><br/></li>
                              <li>TargetPort:<input type="text" id="service[spec][ports][0][targetPort]" style="margin-left:75px;" size=20/></li>
                            </ul>
                          </li>
                          <li><p></p>
                            <ul>
                              <li>Port:<input type="text" id="service[spec][ports][0][port]" style="margin-left:113px;" size=20/><br/></li>
                              <li>TargetPort:<input type="text" id="service[spec][ports][0][targetPort]" style="margin-left:75px;" size=20/></li>
                            </ul>
                          </li>
                          <li><p></p>
                            <ul>
                             <li>Port:<input type="text" id="service[spec][ports][0][port]" style="margin-left:113px;" size=20/><br/></li>
                              <li>TargetPort:<input type="text" id="service[spec][ports][0][targetPort]" style="margin-left:75px;" size=20/></li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                </div>
                <div style="display:table-cell;position:relative;left:80px;"><p></p>
                        <!-- This needs to be changed!!! THINK!! -->
                      <li>Selector:<br/><input type="text" id="service[spec][selector][key]" style="position:absolute;left:80px;"/><input type="text" id="service[spec][selector][value]" style="position:relative;left:240px;"/>:<br/></li><p></p>
                      <li>Type:<input type="text" id="service[spec][type]" style="position:relative;left:45px;"/><br/></li><p></p>
                      
                      <li>
                        <br/><br/><br/>
                        <button type="submit" id="modalService-create" onclick="modalService_create()" style="position:relative;left:285px;background-color: #e7e7e7;font-size: 16px;border-radius: 8px;" > Create </button>
                        <button type="submit" id="modalService-save" onclick="modalService_save()" style="visibility:hidden;" > Save </button>
                      </li>

                </div>
            </div>
          <!-- </li> -->
        </div> <br/>  
        
      </form>     
               
    </div>
            
            
  </div>
  </div>

<div id="modalContainer" class="modal" style="height:999px;">



  <!-- Container Modal content -->
  <div class="modal-content" style="background-color:#BBBF88;">
    <span class="closeContainerModal">x</span>
    <!-- <form name="containerOptions" id="containerOptions"> -->
    <label>Container ID  :  </label><label id="box-id"></label><br/>
    <div style="position:absolute;left:25px;">

    <form id="modalContainerForm" enctype="application/json" action="javascript:modalContainer_create()">
        <input type="hidden" id="config[apiVersion]" value="v1"/>
        <input type="hidden" id="config[kind]" value="ReplicationController"/>
        <div style="width:100%;height:100%;display:table;">
          <div style="display:table-row;"> 
            <div style="display:table-cell;width:30%">Metadata:<br/>
              <ul style="margin-left:12px;">
                <li>Name*     :<input type="text" id="config[metadata][name]" value ="" required="" style="margin-left:100px;"/><br/></li>
                <li>Namespace:<input type="text" id="config[metadata][namespace]" value ="" style="margin-left:72px;"/><br/></li>    
              </ul>
            </div>
            <div style="display:table-cell;width:50%;margin-left:62px;"> <strong>Spec:</strong><br/>
              <ul>
                <li>Spec: Replicas     :<input type="text" id="config[spec][replicas]" style="margin-left:112px;"/><br/></li>
                <li>Spec: Selector:<br/><input type="text" id="config[spec][selector][key]" style="margin-left:114px;"/>:<input type="text" id="config[spec][selector][value]" /><br/></li>
                <li>Spec: Template     :<br/>
                  <ul>
                    <li>Spec: Template: Metadata: Labels:<input type="text" id="config[spec][template][metadata][labels]"/></li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
          <div style="display:table-row;width:100%;text-align: left;">
              <strong> Pod Specification:</strong> 
          </div>
          <div style="display:table-row;">
                <div style="display:table-cell;width:50%">
                    <ul>
                      
                      <li>Image*: <input type="text" id="config[spec][template][spec][containers][image]" required/ style="margin-left:114px;"><br/></li>
                      <li>Command:<br/>
                        <ul style="margin-left:164px;">
                          <li><input type="text" id="config[spec][template][spec][containers][command][0]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][command][1]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][command][2]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][command][3]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][command][4]"/><br/></li>
                        </ul>
                      </li>
                      <li>Arguments:<br/>
                        <ul style="margin-left:164px;">
                          <li><input type="text" id="config[spec][template][spec][containers][args][0]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][args][1]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][args][2]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][args][3]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][args][4]"/><br/></li>
                        </ul>
                      </li>
                      <li><br/>Environment (Name:Value):
                        <ul style="margin-left:170px;position:relative;top:60%px;">
                          <li><input type="text" id="config[spec][template][spec][containers][env][0][name]"/>:<input type="text" id="config[spec][template][spec][containers][env][0][value]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][env][1][name]"/>:<input type="text" id="config[spec][template][spec][containers][env][1][value]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][env][2][name]"/>:<input type="text" id="config[spec][template][spec][containers][env][2][value]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][env][3][name]"/>:<input type="text" id="config[spec][template][spec][containers][env][3][value]"/><br/></li>
                          <li><input type="text" id="config[spec][template][spec][containers][env][4][name]"/>:<input type="text" id="config[spec][template][spec][containers][env][4][value]"/><br/></li>
                        </ul>
                      </li></ul>
                </div>
                <div style="display:table-cell;">
                  <ul>
                      <li><strong>Ports:</strong><br/>
                        <ul>
                          <li>
                      <ul>
                              <li>Container Port:<input type="text" id="config[spec][template][spec][containers][ports][0][containerPort]" style="margin-left:34px;"/></li>
                              <li>Name:<input type="text" id="config[spec][template][spec][containers][ports][0][name]"/></li>
                              <li>Protocol(TCP/UDP):<input type="text" id="config[spec][template][spec][containers][ports][0][protocol]" size:'5' style="margin-left:2px;"/></li>
                     </ul>
                          </li>
                          <li>
                            <ul>
                              <li>Container Port:<input type="text" id="config[spec][template][spec][containers][ports][1][containerPort]" style="margin-left:34px;"/></li>&nbsp;&nbsp;
                              <li>Name:<input type="text" id="config[spec][template][spec][containers][ports][1][name]"/></li>
                              <li>Protocol(TCP/UDP):<input type="text" id="config[spec][template][spec][containers][ports][1][protocol]" style="margin-left:2px;"/></li>
                            </ul>
                          </li>
                          <li>
                            <ul>
                              <li>Container Port:<input type="text" id="config[spec][template][spec][containers][ports][2][containerPort]" style="margin-left:34px;"/></li>&nbsp;&nbsp;
                              <li>Name:<input type="text" id="config[spec][template][spec][containers][ports][2][name]"/></li>
                              <li>Protocol(TCP/UDP):<input type="text" id="config[spec][template][spec][containers][ports][2][protocol]" style="margin-left:2px;"/></li>
                            </ul>
                          </li>
                          <li>
                            <ul>
                              <li>Container Port:<input type="text" id="config[spec][template][spec][containers][ports][3][containerPort]" style="margin-left:34px;"/></li>&nbsp;&nbsp;
                              <li>Name:<input type="text" id="config[spec][template][spec][containers][ports][3][name]"/></li>
                              <li>Protocol(TCP/UDP):<input type="text" id="config[spec][template][spec][containers][ports][3][protocol]" style="margin-left:2px;"/></li>
                            </ul>
                          </li>
                          <li>
                            <ul>
                              <li>Container Port:<input type="text" id="config[spec][template][spec][containers][ports][4][containerPort]" style="margin-left:34px;"/></li>&nbsp;&nbsp;
                              <li>Name:<input type="text" id="config[spec][template][spec][containers][ports][4][name]"/></li>
                              <li>Protocol(TCP/UDP):<input type="text" id="config[spec][template][spec][containers][ports][4][protocol]" style="margin-left:2px;"/></li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <br/><br/><br/>
                        <button type="submit" id="modalContainer-create" style="position:relative;left:285px;background-color: #e7e7e7;font-size: 16px;border-radius: 8px;top:60px;"  > Create </button>
                        <button type="submit" id="modalContainer-save" onclick="modalContainer_save()" style="visibility:hidden;" > Save </button>
                      </li>
                    </ul>
                </div>
            </div>
          <!-- </li> -->
        </div> <br/>  
        
      </form>     
               
    </div>
            
            
  </div>
  </div>


<div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            
            <div class="container-fluid">
                <div id="stage" style="background:#00008B">
                        <h3 id="spinner" style="background: #4d4dff; text-align: center; color: #fff;">PAWN</h3>
                    </div>
                
                <div class="collapse navbar-collapse">
                    
                    <ul class="nav navbar-nav navbar-left" style="position:absolute;right:20px;top:10px;">
                        <li>
                    <a href="dashboard">
                        <i class="pe-7s-graph"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="users">
                        <i class="pe-7s-user"></i>
                        User Profile
                    </a>
                </li>
                <li>
                    <a href="projects">
                        <i class="pe-7s-news-paper"></i>
                        Projects
                    </a>
                </li>
                <li>
                    <a href="index">
                        <i class="pe-7s-bell"></i>
                        Logout
                    </a>
                </li>
                    </ul>
                </div>
            </div>
        </nav>
        
    </div>
<div class="wrapper">
    <div class="sidebar" data-color="azure" data-image="/images/sidebar-5.jpg">

    <!--

        Tip 1: you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple"
        Tip 2: you can also add an image using data-image tag

    -->

      <div class="sidebar-wrapper" >
                <h3 style="position:absolute;left:75px;color:black;">Images</h3>
            <ul class="nav" style="position:absolute;left:80px;top:50px;">
                
                <li class="active">
                    <p onclick="openNav()">Kubernetes Service<br><img id="service" style="background:#222;" src="/images/containers/s.png" draggable="true" ondragstart="drag(event)"  width="90" height="75"></p>
                </li>
                <li>
                    <p onclick="openNav1()">NodeJS Container<br><img id="container_nodejs" style="background:#339;" src="/images/containers/n.jpg" draggable="true" ondragstart="drag(event)"  width="90" height="75"></p>
                </li>
                <li>
                    <p onclick="openNav2()">MongoDB Container<br><img id="container_mongodb" style="background:#090;" src="/images/containers/m.png" draggable="true" ondragstart="drag(event)"  width="90" height="75"></p>
                </li>
               <!--  <li>
                   <p onclick="openNav3()">Node js<br><img id="drag4" style="background:#500;" src="/images/n.jpg" draggable="true" ondragstart="drag(event)" onclick="clicked(this)" width="90" height="75"></p>
                </li>
                <li>
                   <p onclick="openNav4()">Sql<br><img id="drag5" style="background:#888;" src="/images/s.png" draggable="true" ondragstart="drag(event)" onclick="clicked(this)" width="90" height="75"></p>
                </li> -->
                
            </ul>
      </div>
    </div>
  
    <div id="wrapper" ondrop="drop(event)" ondragover="allowDrop(event)"; style="position:absolute;top:68px;left:280px;" >
              <div class="jtk-demo-main" id="workspace-canvas">
        <!-- demo -->
        <div class="jtk-demo-canvas canvas-wide flowchart-demo jtk-surface jtk-surface-nopan" id="canvas">

          <div class="" id="kitchensink-demo">

          <!-- <div id="c3_1" class="w node" data-nodetype="container" ondblclick="openConfig(this)" style="left:30px;top:35px">3.1</div>
                <div id="c3_2" class="w node" data-nodetype="container" ondblclick="openConfig(this)" style="left:80px;top:162px">3.2</div> -->
            
            <div class="w node" id="standalone" data-nodetype="standalone" ondblclick="openConfig(this)" style="left:455px;top:280px;display:none;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

           </div>
            
        </div>
        
    </div>
        <div style="position:absolute;top:10px;left:30px;">
          <ul>
            <li><h3><b><label id="project-name"><%=projName%></label></b></h3></li>
            <li><h7>ID:<label id="project-id"><%=projId%></label></h7></li>
          </ul>
        </div>
        <div style="position:absolute;top:10px;right:10px;">
          <ul>
             <li><button type="submit" onclick="fireup()" style="height:40px;width:60px;"><a href="#save"><strong>Fire Up   </strong></a> </button></li>
             <li><button type="submit" onclick="clear_diagram()" style="height:40px;width:60px;"><a href="#clear"><strong>Clear </strong> </a></button></li>
             <!-- <li><button type="submit" onclick="loadFlowchart()" style="height:40px;width:60px;"><a href="#load"><strong>Load </strong></a></button></li> -->
             <li><button type="submit" style="height:40px;width:60px;"><a href="/projects"><strong>Exit</strong></a></button></li>
          </ul>
        </div>
            
    </div>
   

    </div>
    
    

</body>

    <!--   Core JS Files   -->
<script src="/javascripts/jquery-1.10.2.js" type="text/javascript"></script>
<script src="/javascripts/bootstrap.min.js" type="text/javascript"></script>

  <!--  Checkbox, Radio & Switch Plugins -->
<script src="/javascripts/bootstrap-checkbox-radio-switch.js"></script>

  <!--  Charts Plugin -->
<script src="/javascripts/chartist.min.js"></script>


<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
<script src="/javascripts/light-bootstrap-dashboard.js"></script>

  <!-- Light Bootstrap Table DEMO methods, don't include it in your project! 
  <script src="/javascripts/demo.js"></script>
   JS -->
<!-- support lib for bezier stuff -->
<script src="/javascripts/jsplumb/lib/jsBezier-0.8.js"></script>
<!-- event adapter -->
<script src="/javascripts/jsplumb/lib/mottle-0.7.4.js"></script>
<!-- geometry functions -->
<script src="/javascripts/jsplumb/lib/biltong-0.3.js"></script>
<!-- drag -->
<script src="/javascripts/jsplumb/lib/katavorio-0.18.0.js"></script>
<!-- jsplumb util -->
<script src="/javascripts/jsplumb/src/util.js"></script>
<script src="/javascripts/jsplumb/src/browser-util.js"></script>
<!-- main jsplumb engine -->
<script src="/javascripts/jsplumb/src/jsPlumb.js"></script>
<!-- base DOM adapter -->
<script src="/javascripts/jsplumb/src/dom-adapter.js"></script>
<script src="/javascripts/jsplumb/src/overlay-component.js"></script>
<!-- endpoint -->
<script src="/javascripts/jsplumb/src/endpoint.js"></script>
<!-- connection -->
<script src="/javascripts/jsplumb/src/connection.js"></script>
<!-- anchors -->
<script src="/javascripts/jsplumb/src/anchors.js"></script>
<!-- connectors, endpoint and overlays  -->
<script src="/javascripts/jsplumb/src/defaults.js"></script>
<!-- bezier connectors -->
<script src="/javascripts/jsplumb/src/connectors-bezier.js"></script>
<!-- state machine connectors -->
<script src="/javascripts/jsplumb/src/connectors-statemachine.js"></script>
<!-- flowchart connectors -->
<script src="/javascripts/jsplumb/src/connectors-flowchart.js"></script>
<!-- straight connectors -->
<script src="/javascripts/jsplumb/src/connectors-straight.js"></script>
<!-- SVG renderer -->
<script src="/javascripts/jsplumb/src/renderers-svg.js"></script>
<!-- common adapter -->
<script src="/javascripts/jsplumb/src/base-library-adapter.js"></script>
<!-- no library jsPlumb adapter -->
<script src="/javascripts/jsplumb/src/dom.jsPlumb.js"></script>

<script src="/javascripts/jsplumb/src/group.js"></script>

<script src="/javascripts/workspace/workspace.js"></script>

<script src="/javascripts/workspace/json-formdata.js"></script>

<script type="text/javascript">

  var numberOfElements = 4;
  var containerID;
  var hostIP='192.168.1.8';
  var configFiles={};
   var anchors = [
                    [0.5, 1, 0.5, 0.5]//,
                    // [0.8, 1, 0, 1],
                    // [0, 0.8, -1, 0],
                    // [0.2, 0, 0, -1]
                  ];
  var shouldntHappen = function() {
    console.log('THIS SHOULDN HAPPEN');
  };
  function allowDrop(ev)
  {
    ev.preventDefault();
  }
  function drag(ev)
  {
    ev.dataTransfer.setData("dropped_element",ev.target.id);
  }
  function drop(ev,target)
  {
    var dropped_element=ev.dataTransfer.getData("dropped_element");
    
    if(dropped_element==="service")
    {
      containerID="service_"+ Math.floor(Math.random((Math.random() * 10000) + 1)*10000);
      
      document.getElementById("box-id").innerHTML=containerID;
      document.getElementById("modalService-create").style.visibility='visible';
      document.getElementById("modalService-save").style.visibility='hidden';
      modalService.style.display = "block";
    }
    else if(dropped_element==="container_nodejs"){
      containerID="nodeJS_"+ Math.floor(Math.random((Math.random() * 10000) + 1)*10000);
      document.getElementById("box-id").innerHTML=containerID;
      document.getElementById("modalContainer-create").style.visibility='visible';
      document.getElementById("modalContainer-save").style.visibility='hidden';
      modalContainer.style.display = "block";
    }
    else if(dropped_element==="container_mongodb")
    {
      containerID="mongoDB_"+ Math.floor(Math.random((Math.random() * 10000) + 1)*10000);
      document.getElementById("box-id").innerHTML=containerID;
      document.getElementById("modalContainer-create").style.visibility='visible';
      document.getElementById("modalContainer-save").style.visibility='hidden';
      modalContainer.style.display = "block";
    }
  }

//This function is called after the modal is submitted successfullly
  var cloneStandalone = function(name){
    var newbox = dragMe.cloneNode(true);
    newbox.id=containerID
    newbox.style.display = "block";
    newbox.innerHTML=name+'<br/>'+containerID;
    newbox.style=document.getElementById("standalone").style;
    document.getElementById('canvas').appendChild(newbox);
    var j = window.j;
    j.draggable(newbox.id);

//Anchors for the newly dropped node
    var exampleDropOptions = {
      tolerance: "touch",
      hoverClass: "dropHover",
      activeClass: "dragActive"
    };
    var color2 = "#316b31";
    var exampleEndpoint2 = {
      endpoint: ["Dot", { radius: 5 }],
      paintStyle: { fill: color2 },
      isSource: true,
      scope: "green",
      connectorStyle: { stroke: color2, strokeWidth: 6 },
      connector: ["Bezier", { curviness: 63 } ],
      maxConnections: 3,
      isTarget: true,
      dropOptions: exampleDropOptions
    };

    j.addEndpoint(newbox.id, { anchor: anchors}, exampleEndpoint2);
  }

//This function is called when a node is dropped
  var modalContainer_create = function() {
//Get all the values from the modal box and save it in the sessionStorage of the browser
//***********
    
    var op = containerID.split("_");
///////////////Get json and store/////////////////////

  if(op[0]==='service'){
  service={
    apiVersion: document.getElementById('service[apiVersion]').value,
    kind: document.getElementById('service[kind]').value,
    metadata:{
      name:document.getElementById('service[metadata][name]').value
    },
    spec:{
      ports:[{
        port:document.getElementById('service[spec][ports][0][port]').value,
        targetPort:document.getElementById('service[spec][ports][0][targetPort]').value
      },{
        port:document.getElementById('service[spec][ports][1][port]').value,
        targetPort:document.getElementById('service[spec][ports][1][targetPort]').value
      },
      {
        port:document.getElementById('service[spec][ports][2][port]').value,
        targetPort:document.getElementById('service[spec][ports][2][targetPort]').value
      },{
        port:document.getElementById('service[spec][ports][3][port]').value,
        targetPort:document.getElementById('service[spec][ports][3][targetPort]').value
      }],
      selector:{},
      type:document.getElementById('service[spec][type]').value
    }
  }

  service.spec.selector[document.getElementById('service[spec][selector][key]').value]=document.getElementById('service[spec][selector][value]').value;

  configFiles[containerID]=service;
  cloneStandalone(service.metadata.name);
  }else{

  config={
    apiVersion:document.getElementById('config[apiVersion]').value,
    kind:document.getElementById('config[kind]').value,
    metadata:{
      name:document.getElementById('config[metadata][name]').value,
      namespace:document.getElementById('config[metadata][namespace]').value
    },
    spec:{
      replicas:parseInt(document.getElementById('config[spec][replicas]').value),
      selector:{},
      template:{
        metadata:{
          labels:{
            name:document.getElementById('config[metadata][name]').value}
        },
        spec:{
          containers:[{
            name:document.getElementById('config[metadata][name]').value,
            image:document.getElementById('config[spec][template][spec][containers][image]').value,
            args:[document.getElementById('config[spec][template][spec][containers][args][0]').value,document.getElementById('config[spec][template][spec][containers][args][1]').value,document.getElementById('config[spec][template][spec][containers][args][2]').value,document.getElementById('config[spec][template][spec][containers][args][3]').value,document.getElementById('config[spec][template][spec][containers][args][4]').value],
            command:[document.getElementById('config[spec][template][spec][containers][command][0]').value,document.getElementById('config[spec][template][spec][containers][command][1]').value,document.getElementById('config[spec][template][spec][containers][command][2]').value,document.getElementById('config[spec][template][spec][containers][command][3]').value,document.getElementById('config[spec][template][spec][containers][command][4]').value],
            env:[{
                name:document.getElementById('config[spec][template][spec][containers][env][0][name]').value,
                value:document.getElementById('config[spec][template][spec][containers][env][0][value]').value
              },{
                name:document.getElementById('config[spec][template][spec][containers][env][1][name]').value,
                value:document.getElementById('config[spec][template][spec][containers][env][1][value]').value
              },{
                name:document.getElementById('config[spec][template][spec][containers][env][2][name]').value,
                value:document.getElementById('config[spec][template][spec][containers][env][2][value]').value
              },{
                name:document.getElementById('config[spec][template][spec][containers][env][3][name]').value,
                value:document.getElementById('config[spec][template][spec][containers][env][3][value]').value
              },{
                name:document.getElementById('config[spec][template][spec][containers][env][4][name]').value,
                value:document.getElementById('config[spec][template][spec][containers][env][4][value]').value
            }],
            ports:[{
              containerPort:parseInt(document.getElementById('config[spec][template][spec][containers][ports][0][containerPort]').value),
              name:document.getElementById('config[spec][template][spec][containers][ports][0][name]').value,
              protocol:document.getElementById('config[spec][template][spec][containers][ports][0][protocol]').value
            },{
              containerPort:parseInt(document.getElementById('config[spec][template][spec][containers][ports][1][containerPort]').value),
              name:document.getElementById('config[spec][template][spec][containers][ports][1][name]').value,
              protocol:document.getElementById('config[spec][template][spec][containers][ports][1][protocol]').value
            },{
              containerPort:parseInt(document.getElementById('config[spec][template][spec][containers][ports][2][containerPort]').value),
              name:document.getElementById('config[spec][template][spec][containers][ports][2][name]').value,
              protocol:document.getElementById('config[spec][template][spec][containers][ports][2][protocol]').value
            },{
              containerPort:parseInt(document.getElementById('config[spec][template][spec][containers][ports][3][containerPort]').value),
              name:document.getElementById('config[spec][template][spec][containers][ports][3][name]').value,
              protocol:document.getElementById('config[spec][template][spec][containers][ports][3][protocol]').value
            },{
              containerPort:parseInt(document.getElementById('config[spec][template][spec][containers][ports][4][containerPort]').value),
              name:document.getElementById('config[spec][template][spec][containers][ports][4][name]').value,
              protocol:document.getElementById('config[spec][template][spec][containers][ports][4][protocol]').value
            }]
          }]
        }
      }
    }
  }
  config.spec.selector[document.getElementById('config[spec][selector][key]').value]=document.getElementById('config[spec][selector][value]').value
  configFiles[containerID]=config;
  cloneStandalone(config.metadata.name);
  }
///////////////End////////////////////

//console.log(config);

//End - values from modal box
    
    modalContainer.style.display = "none";
    //updateSessionValues(containerID,config);
    
//var obj = JSON.parse(sessionStorage.user);

  }
  var modalContainer_save = function(){
//***************
    var name = document.getElementById("container-name").value;
    var id = document.getElementById("box-id").value;
    document.getElementById(id).innerHTML=name+'<br/>'+id;
    //updateSessionValues(id,name);
    configFiles[id]=config;
    modalContainer.style.display = "none";
  }

//Element that is to be cloned!
  var dragMe = document.getElementById('standalone');
  var modalContainer = document.getElementById('modalContainer');
  var modalService = document.getElementById('modalService');
// Get the button that opens the modal
  var btn = document.getElementById("myBtn");
// Get the <span> element that closes the modal
  var spanContainer = document.getElementsByClassName("closeContainerModal")[0];
  var spanService = document.getElementsByClassName("closeServiceModal")[0];

  spanContainer.onclick = function() {
    modalContainer.style.display = "none";
  }
  spanService.onclick = function() {
    modalService.style.display = "none";
  }
    
  var fireup=function(){
    //Save the entire diagram !!!
    saveFlowchart();
    //send flowChartJson and config to nodejs
    //console.log(projName);
    //console.log(<%=projName%>);
    //console.log("<%projName%>");
    var projName= <%- JSON.stringify(projName) %>;
    var projId = <%- JSON.stringify(projId) %>;
    var data ={
      chart:JSON.parse(flowChartJson),
      config:configFiles,
      projName:projName,
      projId:projId
    }

      var url = 'http://'+hostIP+':3000/workspace/fireUpContainers';
      var xhr = new XMLHttpRequest();
      xhr.open("POST",url,true);
      xhr.setRequestHeader('Content-Type' , 'application/json; charset=utf-8');
      //xhr.setRequestHeader('X-XSRF-Token',);
      xhr.send(JSON.stringify(data));

  }

  var openConfig=function(cont){
    op = (cont.id).split("_");
    if(op[0] !== 'service'){
    configFiles[cont.id]
    document.getElementById('config[apiVersion]').value=configFiles[cont.id].apiVersion;
    document.getElementById('config[kind]').value=configFiles[cont.id].value;
    document.getElementById('config[metadata][name]').value=configFiles[cont.id].metadata.name;
    document.getElementById('config[metadata][namespace]').value=configFiles[cont.id].metadata.namespace;
    document.getElementById('config[spec][replicas]').value=configFiles[cont.id].spec.replicas;
    document.getElementById('config[spec][selector][key]').value=Object.Keys(configFiles[cont.id].spec.selector)[0];
    document.getElementById('config[spec][selector][value]').value=configFiles[cont.id].spec.selector[Object.Keys(configFiles[cont.id].spec.selector)[0]];
    document.getElementById('config[metadata][name]').value=configFiles[cont.id].metadata.namespace;

    document.getElementById('config[spec][template][spec][containers][image]').value=configFiles[cont.id].spec.template.spec.containers.image;
    document.getElementById('config[spec][template][spec][containers][args][0]').value=configFiles[cont.id].spec.template.spec.containers.args[0];
    document.getElementById('config[spec][template][spec][containers][args][1]').value=configFiles[cont.id].spec.template.spec.containers.args[1];
    document.getElementById('config[spec][template][spec][containers][args][2]').value=configFiles[cont.id].spec.template.spec.containers.args[2];
    document.getElementById('config[spec][template][spec][containers][args][3]').value=configFiles[cont.id].spec.template.spec.containers.args[3];


    document.getElementById('config[spec][template][spec][containers][command][0]').value=configFiles[cont.id].spec.template.spec.containers.command[0];
    document.getElementById('config[spec][template][spec][containers][command][1]').value=configFiles[cont.id].spec.template.spec.containers.command[1];
    document.getElementById('config[spec][template][spec][containers][command][2]').value=configFiles[cont.id].spec.template.spec.containers.command[2];
    document.getElementById('config[spec][template][spec][containers][command][3]').value=configFiles[cont.id].spec.template.spec.containers.command[3];

    document.getElementById('config[spec][template][spec][containers][env][0][name]').value=configFiles[cont.id].spec.template.spec.containers.env[0].name;
    document.getElementById('config[spec][template][spec][containers][env][0][value]').value=configFiles[cont.id].spec.template.spec.containers.env[0].value;
    document.getElementById('config[spec][template][spec][containers][env][1][name]').value=configFiles[cont.id].spec.template.spec.containers.env[1].name;
    document.getElementById('config[spec][template][spec][containers][env][1][value]').value=configFiles[cont.id].spec.template.spec.containers.env[1].value;
    document.getElementById('config[spec][template][spec][containers][env][2][name]').value=configFiles[cont.id].spec.template.spec.containers.env[2].name;
    document.getElementById('config[spec][template][spec][containers][env][2][value]').value=configFiles[cont.id].spec.template.spec.containers.env[2].value;
    document.getElementById('config[spec][template][spec][containers][env][3][name]').value=configFiles[cont.id].spec.template.spec.containers.env[3].name;
    document.getElementById('config[spec][template][spec][containers][env][3][value]').value=configFiles[cont.id].spec.template.spec.containers.env[3].value;

    document.getElementById('config[spec][template][spec][containers][ports][0][containerPort]').value=configFiles[cont.id].spec.template.spec.containers.ports[0].containerPort;
    document.getElementById('config[spec][template][spec][containers][ports][0][name]').value=configFiles[cont.id].spec.template.spec.containers.ports[0].name;
    document.getElementById('config[spec][template][spec][containers][ports][0][protocol]').value=configFiles[cont.id].spec.template.spec.containers.ports[0].protocol;
    document.getElementById('config[spec][template][spec][containers][ports][1][containerPort]').value=configFiles[cont.id].spec.template.spec.containers.ports[1].containerPort;
    document.getElementById('config[spec][template][spec][containers][ports][1][name]').value=configFiles[cont.id].spec.template.spec.containers.ports[1].name;
    document.getElementById('config[spec][template][spec][containers][ports][1][protocol]').value=configFiles[cont.id].spec.template.spec.containers.ports[1].protocol;
    document.getElementById('config[spec][template][spec][containers][ports][2][containerPort]').value=configFiles[cont.id].spec.template.spec.containers.ports[2].containerPort;
    document.getElementById('config[spec][template][spec][containers][ports][2][name]').value=configFiles[cont.id].spec.template.spec.containers.ports[2].name;
    document.getElementById('config[spec][template][spec][containers][ports][2][protocol]').value=configFiles[cont.id].spec.template.spec.containers.ports[2].protocol;
    document.getElementById('config[spec][template][spec][containers][ports][3][containerPort]').value=configFiles[cont.id].spec.template.spec.containers.ports[3].containerPort;
    document.getElementById('config[spec][template][spec][containers][ports][3][name]').value=configFiles[cont.id].spec.template.spec.containers.ports[3].name;
    document.getElementById('config[spec][template][spec][containers][ports][3][protocol]').value=configFiles[cont.id].spec.template.spec.containers.ports[3].protocol;
  }
  else{
    document.getElementById('service[apiVersion]').value=configFiles[cont.id].apiVersion;
    document.getElementById('service[kind]').value=configFiles[cont.id].kind;
    document.getElementById('service[metadata][name]').value=configFiles[cont.id].metadata.name;

    document.getElementById('service[spec][ports][0][port]').value=configFiles[cont.id].spec.ports[0].port;
    document.getElementById('service[spec][ports][0][targetPort]').value=configFiles[cont.id].spec.ports[0].targetPort;
    document.getElementById('service[spec][ports][1][port]').value=configFiles[cont.id].spec.ports[1].port;
    document.getElementById('service[spec][ports][1][targetPort]').value=configFiles[cont.id].spec.ports[1].targetPort;
    document.getElementById('service[spec][ports][2][port]').value=configFiles[cont.id].spec.ports[2].port;
    document.getElementById('service[spec][ports][2][targetPort]').value=configFiles[cont.id].spec.ports[2].targetPort;
    document.getElementById('service[spec][ports][3][port]').value=configFiles[cont.id].spec.ports[3].port;
    document.getElementById('service[spec][ports][3][targetPort]').value=configFiles[cont.id].spec.ports[3].targetPort;

    document.getElementById('service[spec][selector][type]').value=configFiles[cont.id].spec.type;
    document.getElementById('service[spec][selector][key]').value=configFiles[cont.id].spec.selector.key;
    document.getElementById('service[spec][selector][value]').value=configFiles[cont.id].spec.selector.value;

  }


    // var obj = JSON.parse(sessionStorage.getItem(cont.id));
    // updateModalValues(obj.id,obj.name);
    // containerID=cont.id;
    // document.getElementById("modalContainer-create").style.visibility='hidden';
    // document.getElementById("modalContainer-save").style.visibility='visible';
    // modalContainer.style.display = "block";
  }

//Update the values of the modal with the passed values!! This avoids a lot of repeatition!
  var updateModalValues=function(id,name){
    document.getElementById("box-id").value=id;
    document.getElementById("container-name").value=name;
  }
//Update the values of the modal with the passed values!! This avoids a lot of repeatition!
  var updateSessionValues=function(id,name){
    var containerConfig = {
                            'id':id,
                            'name':name
                          };
    sessionStorage.setItem(id, JSON.stringify(containerConfig));
  }
  var endpoints = [];
  function saveFlowchart(){
    
    var nodes = []
    var jsPlumb = window.j;
    $(".node:not(#standalone)").each(function (idx, elem) {
    var $elem = $(elem);
    console.log($elem.css);
    endpoints.push(jsPlumb.getEndpoints($elem.attr('id')));
    console.log('endpoints of '+$elem.attr('id'));
    console.log(endpoints);
      nodes.push({
        blockId: $elem.attr('id'),
        nodetype: $elem.attr('data-nodetype'),
        positionX: parseInt($elem.css("left"), 10),
        positionY: parseInt($elem.css("top"), 10)
      });
    });
    
    var connections = [];
    
    $.each(jsPlumb.getAllConnections(), function (idx, connection) {
      connections.push({
        connectionId: connection.id,
        pageSourceId: connection.sourceId,
        pageTargetId: connection.targetId
      });
    });
    
    var flowChart = {};
    flowChart.nodes = nodes;
    flowChart.connections = connections;
    flowChart.numberOfElements = numberOfElements;
    
    flowChartJson = JSON.stringify(flowChart);
    //console.log(flowChartJson);

    //savedObj = jsPlumb.save({selector : ".node:not(#standalone)" });
    
    //$('#jsonOutput').val(flowChartJson);

//End of save function
  }
  var flowChartJson;
  var savedObj
  //var jsPlumbInst = window.j;
  function loadFlowchart(){

    var jsPlumb = window.j;
    //var flowChartJson = $('#jsonOutput').val();
    var flowChart = JSON.parse(flowChartJson);
    var nodes = flowChart.nodes;
    function repositionElement(id, posX, posY, eindex){
      var dragMe = document.getElementById('standalone');
      var newbox = dragMe.cloneNode(true);
      console.log(newbox.style.left);
      console.log(dragMe.style.left);
      newbox.id=id
      newbox.style.display = "block";
      newbox.style=document.getElementById("standalone").style;
    
      newbox.innerHTML=id;

      newbox.style.position= "absolute";
      newbox.style.left=''+posX+'px';
      newbox.style.top=''+posY+'px';

      console.log(posX);
      console.log(newbox.style.left);
      document.getElementById('kitchensink-demo').appendChild(newbox);
      console.log(newbox.style.left);

      document.getElementById(id).style.position="absolute";
      document.getElementById(id).style.left=''+posX+'px';
      document.getElementById(id).style.top=''+posY+'px';
    
      

      var exampleDropOptions = {
        tolerance: "touch",
        hoverClass: "dropHover",
        activeClass: "dragActive"
      };
      var color2 = "#316b31";
      var exampleEndpoint2 = {
        endpoint: ["Dot", { radius: 5 }],
        paintStyle: { fill: color2 },
        isSource: true,
        scope: "green",
        connectorStyle: { stroke: color2, strokeWidth: 6 },
        connector: ["Bezier", { curviness: 63 } ],
        maxConnections: 3,
        isTarget: true,
        dropOptions: exampleDropOptions
      };

      var e1 = j.addEndpoint(newbox.id, {anchor: anchors,uuid:id}, exampleEndpoint2);
      jsPlumb.draggable(newbox.id);
      
  }
  $.each(nodes, function( index, elem ) {
    // if(elem.nodetype === 'startpoint'){
      console.log(elem.blockId);

       repositionElement(elem.blockId, elem.positionX, elem.positionY,index);
    // }else if(elem.nodetype === 'endpoint'){
    //   repositionElement('endpoint', elem.positionX, elem.positionY);
    // }else if(elem.nodetype === 'task'){
    //   var id = addTask(elem.blockId);
    //   repositionElement(id, elem.positionX, elem.positionY);
    // }else if(elem.nodetype === 'decision'){
    //   var id = addDecision(elem.blockId);
    //   repositionElement(id, elem.positionX, elem.positionY);
    // }else{
      
    // }

  });
              
  var connections = flowChart.connections;
  $.each(connections, function( index, elem ) {
   
     var connection1 = jsPlumb.connect({
      // source: elem.pageSourceId,
      // target: elem.pageTargetId,
      // anchors: anchors
      uuids:[elem.pageSourceId,elem.pageTargetId]
    });
  });
  
  numberOfElements = flowChart.numberOfElements;
  
//End of load function
  }
  var clear_diagram=function(){
    var jsPlumb = window.j;

    $(".node:not(#standalone)").each(function () {
            jsPlumb.detachAllConnections($(this));
            jsPlumb.unmakeTarget($(this), false);
            jsPlumb.removeAllEndpoints($(this));
        });
    // var conns = jsPlumb.getAllConnections();
    // for (var i = 0; i < conns.length; i++)
    // jsPlumb.detach(conns[i]);
    // jsPlumb.removeAllEndpoints(someElement or element Id);
    $(".node:not(#standalone)").remove();
  }




</script>
</html>
